<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PRAGATI ECOSOLAR HYBRID CALCULATOR</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#a8e6cf 0%,#dcedc1 100%);color:#333;}
    .container{max-width:1050px;margin:auto;padding:20px;background:#f1f8e9;box-shadow:0 0 15px rgba(0,0,0,0.1);border-radius:10px;margin-top:30px;}
    h1{text-align:center;color:#388e3c;background:-webkit-linear-gradient(#81c784,#388e3c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:2em;margin-bottom:6px;}
    .sub{text-align:center;color:#2e7d32;margin:0 0 18px;font-size:0.98em;}
    h2{color:#388e3c;border-bottom:2px solid #388e3c;padding-bottom:5px;}
    label{display:block;margin-top:12px;font-weight:bold;color:#2e7d32;}
    input,select{display:block;padding:8px;font-size:1em;border:1px solid #ccc;border-radius:6px;width:100%;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);margin-bottom:10px;}
    button{background-color:#66bb6a;color:white;padding:10px 16px;margin-top:10px;font-size:1em;border:none;border-radius:6px;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,0.2);}
    button:hover{background-color:#43a047;}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:6px;}
    .whats{background:#25D366;display:none;}
    .whats:hover{background:#1da851;}
    #equipmentTable{width:100%;border-collapse:collapse;margin-top:12px;}
    #equipmentTable th,#equipmentTable td{border:1px solid #c8e6c9;padding:8px;text-align:center;vertical-align:middle;}
    #equipmentTable th{background-color:#a5d6a7;color:#1b5e20;}
    .remove-btn{background-color:#f44336;color:white;border:none;border-radius:4px;padding:5px 10px;cursor:pointer;}
    .remove-btn:hover{background-color:#d32f2f;}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
    @media(max-width:900px){.grid3{grid-template-columns:1fr;}.grid2{grid-template-columns:1fr;}}
    .hint{font-size:0.92em;color:#2e7d32;opacity:0.92;margin-top:6px;}
    .error{color:#b71c1c;font-weight:700;margin-top:10px;display:none;}
    .result{margin-top:18px;border:2px solid #81c784;background:#e8f5e9;border-radius:8px;overflow:hidden;display:none;}
    .result .hdr{background:#66bb6a;color:white;padding:10px 12px;font-weight:800;}
    .result .body{padding:12px;}
    .kv{display:grid;grid-template-columns:1.2fr 1fr;gap:8px;padding:6px 0;border-bottom:1px solid #c8e6c9;}
    .kv:last-child{border-bottom:none;}
    .k{font-weight:700;}
    .v{font-weight:800;}
    .pill{display:inline-block;background:#c8e6c9;color:#1b5e20;padding:2px 8px;border-radius:999px;font-weight:800;}
  </style>
</head>
<body>
<div class="container">
  <h1>PRAGATI ECOSOLAR HYBRID CALCULATOR</h1>
  <p class="sub">Rule: <b>1 Unit = 1 kWh = 1000W running for 1 hour</b></p>

  <h2>Equipment List (Backup Load)</h2>
  <div class="hint">Peak Load decides inverter size. Battery uses backup hours. Panels will be calculated from inverter size.</div>

  <table id="equipmentTable">
    <thead>
      <tr>
        <th>Equipment</th>
        <th>Watt (W)</th>
        <th>Qty</th>
        <th>Backup Hours</th>
        <th>Energy (Wh)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="equipmentContainer"></tbody>
  </table>
  <button type="button" id="addRowBtn">âž• Add Equipment</button>

  <h2>System Inputs</h2>

  <div class="grid3">
    <div>
      <label for="panelWattage">Panel Wattage (W):</label>
      <input type="number" id="panelWattage" value="600" min="100" step="10"/>
    </div>
    <div>
      <label for="pf">Power Factor (for kVA):</label>
      <input type="number" id="pf" value="0.8" min="0.6" max="1" step="0.01"/>
    </div>
    <div>
      <label for="headroom">Inverter Headroom %:</label>
      <input type="number" id="headroom" value="25" min="0" max="60" step="1"/>
    </div>
  </div>

  <div class="grid3">
    <div>
      <label for="pvRatio">PV Size Multiplier (DC/AC Ratio):</label>
      <input type="number" id="pvRatio" value="1.20" min="0.8" max="1.6" step="0.05"/>
      <div class="hint">Common: 1.0 to 1.3 (Default 1.2)</div>
    </div>
    <div>
      <label for="systemVoltage">Battery Bank Voltage:</label>
      <select id="systemVoltage">
        <option value="48" selected>48V (Recommended)</option>
        <option value="24">24V</option>
      </select>
    </div>
    <div>
      <label for="leadAh">Lead Acid Battery (12V):</label>
      <select id="leadAh">
        <option value="150" selected>12V 150Ah</option>
        <option value="200">12V 200Ah</option>
      </select>
    </div>
  </div>

  <div class="grid2">
    <div>
      <label>Lithium Battery:</label>
      <input type="text" value="51.2V 100Ah (Fixed)" readonly />
    </div>
    <div>
      <label for="lithiumDoD">Lithium Usable % (DoD):</label>
      <input type="number" id="lithiumDoD" value="0.90" min="0.7" max="0.98" step="0.01"/>
    </div>
  </div>

  <div class="btnRow">
    <button type="button" id="calculateBtn">ðŸ§® Calculate</button>
    <button type="button" class="whats" id="whatsBtn">ðŸ“² Share on WhatsApp</button>
  </div>

  <div id="errorBox" class="error"></div>

  <div class="result" id="resultBox">
    <div class="hdr">Result (Telecaller Output)</div>
    <div class="body" id="resultBody"></div>
  </div>
</div>

<script>
(function(){
  "use strict";

  var equipmentList = {
    "Fan": 75,
    "LED Bulb": 9,
    "Tube Light": 40,
    "TV": 120,
    "Refrigerator": 180,
    "Ceiling Fan": 70,
    "Mixer Grinder": 500,
    "Washing Machine": 600,
    "Microwave": 1200,
    "Iron": 1000,
    "Laptop": 60,
    "Desktop Computer": 150,
    "Water Pump": 750,
    "Air Conditioner (1 Ton)": 1200,
    "Air Conditioner (1.5 Ton)": 1800
  };

  function $(id){ return document.getElementById(id); }
  var lastShareText = "";

  function showError(msg){ var b=$("errorBox"); b.textContent=msg; b.style.display="block"; }
  function clearError(){ var b=$("errorBox"); b.textContent=""; b.style.display="none"; }

  function pickStandardKVA(kva){
    var std=[0.8,1,1.1,1.5,2,2.2,3,3.3,4,4.4,5,6,7.5,8,10,12,15,20];
    for (var i=0;i<std.length;i++){ if (kva<=std[i]) return std[i]; }
    return Math.ceil(kva);
  }

  function createEquipmentRow(){
    var tbody=$("equipmentContainer"); if(!tbody) return;
    var row=document.createElement("tr");

    var equipSelect=document.createElement("select");
    var opt0=document.createElement("option"); opt0.value=""; opt0.textContent="Select";
    equipSelect.appendChild(opt0);
    for (var k in equipmentList){
      if(equipmentList.hasOwnProperty(k)){
        var opt=document.createElement("option");
        opt.value=k; opt.textContent=k;
        equipSelect.appendChild(opt);
      }
    }

    var wattInput=document.createElement("input"); wattInput.type="number"; wattInput.min="0";
    var qtyInput=document.createElement("input"); qtyInput.type="number"; qtyInput.min="0"; qtyInput.value="1";
    var hoursInput=document.createElement("input"); hoursInput.type="number"; hoursInput.min="0"; hoursInput.step="0.5"; hoursInput.value="1";
    var whCell=document.createElement("td"); whCell.textContent="0";

    function updateRow(){
      var w=Number(wattInput.value)||0;
      var q=Number(qtyInput.value)||0;
      var h=Number(hoursInput.value)||0;
      whCell.textContent=String(Math.round(w*q*h));
    }

    equipSelect.addEventListener("change", function(){
      var v=equipSelect.value;
      if(v && equipmentList[v]!=null) wattInput.value=equipmentList[v];
      updateRow();
    });
    wattInput.addEventListener("input", updateRow);
    qtyInput.addEventListener("input", updateRow);
    hoursInput.addEventListener("input", updateRow);

    var removeBtn=document.createElement("button");
    removeBtn.type="button"; removeBtn.className="remove-btn"; removeBtn.textContent="âŒ";
    removeBtn.addEventListener("click", function(){ row.remove(); });

    function tdWith(el){ var td=document.createElement("td"); td.appendChild(el); return td; }

    row.appendChild(tdWith(equipSelect));
    row.appendChild(tdWith(wattInput));
    row.appendChild(tdWith(qtyInput));
    row.appendChild(tdWith(hoursInput));
    row.appendChild(whCell);

    var act=document.createElement("td"); act.appendChild(removeBtn); row.appendChild(act);
    tbody.appendChild(row);
    updateRow();
  }

  function calculateSystem(){
    clearError();
    lastShareText="";
    $("whatsBtn").style.display="none";

    var panelW=Number($("panelWattage").value);
    var pf=Number($("pf").value);
    var headroomPct=Number($("headroom").value)/100;
    var pvRatio=Number($("pvRatio").value);
    var sysV=Number($("systemVoltage").value);
    var leadAh=Number($("leadAh").value);
    var lithiumDoD=Number($("lithiumDoD").value);

    if(!(panelW>0)) return showError("Enter Panel Wattage (e.g., 600).");
    if(!(pf>0 && pf<=1)) return showError("PF must be 0â€“1 (recommended 0.8).");
    if(!(pvRatio>0)) return showError("PV Multiplier must be > 0 (default 1.2).");
    if(!(lithiumDoD>0 && lithiumDoD<=1)) return showError("Lithium usable % must be 0â€“1 (default 0.90).");

    var totalWh=0;
    var peakW=0;

    var rows=document.querySelectorAll("#equipmentContainer tr");
    for(var i=0;i<rows.length;i++){
      var r=rows[i];
      var sel=r.cells[0].querySelector("select");
      var w=Number(r.cells[1].querySelector("input").value)||0;
      var q=Number(r.cells[2].querySelector("input").value)||0;
      var h=Number(r.cells[3].querySelector("input").value)||0;

      if(sel && sel.value && w>0 && q>0 && h>=0){
        totalWh += (w*q*h);   // energy
        peakW  += (w*q);      // peak
      }
    }
    if(!(totalWh>0)) return showError("Add at least one equipment with Qty and Backup Hours.");

    // Inverter from peak load
    var invW = peakW * (1 + headroomPct);
    var invKva = (invW/1000) / pf;
    var invStd = pickStandardKVA(invKva);

    // âœ… Panels from inverter size (your requirement)
    // Solar kW = Inverter kVA Ã— PV ratio
    var solarKw = invStd * pvRatio;
    var panels = Math.ceil((solarKw * 1000) / panelW);
    if(panels < 1) panels = 1;

    // Units
    var unitsKwh = totalWh / 1000;

    // Lead Acid batteries (energy based)
    var invEff=0.90, leadDoD=0.80;
    var seriesCount = (sysV===48)?4:2;
    var usableWhPerString = (sysV * leadAh) * leadDoD * invEff;
    var leadStrings = Math.ceil(totalWh / usableWhPerString);
    if(leadStrings < 1) leadStrings = 1;
    var leadBatteries = leadStrings * seriesCount;

    // Lithium fixed 51.2V 100Ah
    var lithiumV=51.2, lithiumAh=100;
    var lithiumNominalWh = lithiumV * lithiumAh; // 5120Wh
    var lithiumSysEff=0.95;
    var lithiumUsableWh = lithiumNominalWh * lithiumDoD * lithiumSysEff;
    var lithiumModules = Math.ceil(totalWh / lithiumUsableWh);
    if(lithiumModules < 1) lithiumModules = 1;

    // Render results
    var html="";
    html += '<div class="kv"><div class="k">Backup Energy</div><div class="v"><span class="pill">'+unitsKwh.toFixed(2)+' Unit</span> ('+Math.round(totalWh)+' Wh)</div></div>';
    html += '<div class="kv"><div class="k">Peak Backup Load</div><div class="v">'+Math.round(peakW)+' W</div></div>';
    html += '<div class="kv"><div class="k">Suggested Inverter</div><div class="v">'+invStd+' kVA (calc: '+invKva.toFixed(2)+' kVA)</div></div>';
    html += '<div class="kv"><div class="k">Solar Plant (from Inverter)</div><div class="v">'+solarKw.toFixed(2)+' kW (PV ratio '+pvRatio.toFixed(2)+')</div></div>';
    html += '<div class="kv"><div class="k">Panels</div><div class="v">'+panels+' Ã— '+panelW+'W</div></div>';
    html += '<div class="kv"><div class="k">Lead Acid Battery (12V)</div><div class="v">'+leadBatteries+' batteries â€” 12V '+leadAh+'Ah (Series '+seriesCount+' Ã— Parallel '+leadStrings+')</div></div>';
    html += '<div class="kv"><div class="k">Lithium Battery</div><div class="v">'+lithiumModules+' module(s) of <b>51.2V 100Ah</b> (usable â‰ˆ '+(lithiumUsableWh/1000).toFixed(2)+' kWh each)</div></div>';
    html += '<div class="hint">Panels are calculated from inverter size: Solar kW = Inverter kVA Ã— PV ratio.</div>';

    $("resultBody").innerHTML = html;
    $("resultBox").style.display = "block";

    // WhatsApp message
    lastShareText =
      "Pragati EcoSolar / SolarBee âœ…\n" +
      "Backup: " + unitsKwh.toFixed(2) + " Unit (kWh)\n" +
      "Peak Load: " + Math.round(peakW) + " W\n\n" +
      "Inverter: " + invStd + " kVA\n" +
      "Solar Plant (from inverter): " + solarKw.toFixed(2) + " kW (PV ratio " + pvRatio.toFixed(2) + ")\n" +
      "Panels: " + panels + " Ã— " + panelW + "W\n\n" +
      "Battery Options:\n" +
      "1) Lead Acid: " + leadBatteries + " batteries (12V " + leadAh + "Ah) [" + sysV + "V bank: Series " + seriesCount + " Ã— Parallel " + leadStrings + "]\n" +
      "2) Lithium: " + lithiumModules + " module(s) of 51.2V 100Ah";

    $("whatsBtn").style.display = "inline-block";
  }

  function shareWhatsApp(){
    if(!lastShareText) return;
    window.open("https://wa.me/?text="+encodeURIComponent(lastShareText), "_blank");
  }

  document.addEventListener("DOMContentLoaded", function(){
    $("addRowBtn").addEventListener("click", createEquipmentRow);
    $("calculateBtn").addEventListener("click", calculateSystem);
    $("whatsBtn").addEventListener("click", shareWhatsApp);
    createEquipmentRow();
  });
})();
</script>
</body>
</html>
